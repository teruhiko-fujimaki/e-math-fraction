<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>分数の割り算</title>
    <style>
        :root {
            --primary-color: #4a90e2;
            --dividend-color: #ffcccc; 
            --divisor-color: #ccffcc;  
            --border-color: #333;
            --grid-line-color: #e0e0e0; /* グリッド線の色 */
        }

        body {
            font-family: 'Helvetica Neue', Arial, sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            background-color: #f0f2f5;
            padding: 20px;
        }

        .container {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 850px;
        }

        .controls {
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin-bottom: 2rem;
            background: #f8f9fa;
            padding: 1.5rem;
            border-radius: 8px;
        }

        .fraction-input, .fraction-result {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 5px;
        }

        input[type="number"] {
            width: 75px;
            font-size: 1.8rem;
            text-align: center;
            border: 2px solid #ddd;
            border-radius: 4px;
        }

        .fraction-line {
            width: 85px;
            height: 3px;
            background: var(--border-color);
        }

        .res-num, .res-den {
            font-size: 2.2rem;
            font-weight: bold;
            color: var(--primary-color);
        }

        .operator {
            font-size: 2.5rem;
            font-weight: bold;
        }

        #visual-area {
            width: 100%;
            height: 220px;
            border-bottom: 3px solid #333;
            position: relative;
            margin-top: 20px;
            background-color: white;
            overflow: hidden;
        }

        /* 縦線のスタイル */
        .v-grid-line {
            position: absolute;
            top: 0;
            bottom: 0;
            width: 1px;
            background-color: var(--grid-line-color);
            z-index: 0;
        }

        .bar {
            position: absolute;
            height: 65px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 1.2rem;
            box-sizing: border-box;
            border: 2px solid;
            border-radius: 6px;
            z-index: 1;
        }

        .dividend-bar {
            top: 40px;
            background-color: var(--dividend-color);
            border-color: #ff4444;
        }

        .divisor-bar {
            top: 110px;
            background-color: var(--divisor-color);
            border-color: #2ecc71;
        }

        .ruler-mark {
            position: absolute;
            bottom: 0;
            transform: translateX(-50%);
            text-align: center;
            font-weight: bold;
            z-index: 2;
        }
        .ruler-line {
            width: 2px;
            height: 10px;
            background: #333;
            margin: 0 auto;
        }

        .explanation-card {
            margin-top: 2.5rem;
            padding: 1.5rem;
            background: #eef6ff;
            border-radius: 8px;
            border-left: 5px solid var(--primary-color);
            font-size: 1.4rem;
            text-align: center;
            line-height: 1.6;
        }
    </style>
</head>
<body>

<div class="container">
    <h2 style="text-align:center; color:#333;">分数の割り算「何個入るかな」</h2>

    <div class="controls">
        <div class="fraction-input">
            <input type="number" id="num1" value="1" min="1" oninput="update()">
            <div class="fraction-line"></div>
            <input type="number" id="den1" value="4" min="1" oninput="update()">
        </div>
        <div class="operator">÷</div>
        <div class="fraction-input">
            <input type="number" id="num2" value="1" min="1" oninput="update()">
            <div class="fraction-line"></div>
            <input type="number" id="den2" value="2" min="1" oninput="update()">
        </div>
        <div class="operator">=</div>
        <div class="fraction-result" id="fraction-ans-area">
            <div class="res-num" id="ans-num">1</div>
            <div id="ans-line" class="fraction-line"></div>
            <div class="res-den" id="ans-den">2</div>
        </div>
        <div id="integer-ans-area" class="res-num" style="display:none;"></div>
    </div>

    <div id="visual-area"></div>

    <div class="explanation-card" id="explanation"></div>
</div>

<script>
    function gcd(a, b) {
        return b === 0 ? a : gcd(b, a % b);
    }

    function update() {
        const n1 = parseInt(document.getElementById('num1').value) || 1;
        const d1 = parseInt(document.getElementById('den1').value) || 1;
        const n2 = parseInt(document.getElementById('num2').value) || 1;
        const d2 = parseInt(document.getElementById('den2').value) || 1;

        let resNum = n1 * d2;
        let resDen = d1 * n2;
        const common = gcd(resNum, resDen);
        resNum /= common;
        resDen /= common;

        const ansArea = document.getElementById('fraction-ans-area');
        const intArea = document.getElementById('integer-ans-area');
        if (resDen === 1) {
            ansArea.style.display = 'none';
            intArea.style.display = 'block';
            intArea.innerText = resNum;
        } else {
            ansArea.style.display = 'flex';
            intArea.style.display = 'none';
            document.getElementById('ans-num').innerText = resNum;
            document.getElementById('ans-den').innerText = resDen;
        }

        const visualArea = document.getElementById('visual-area');
        visualArea.innerHTML = '';
        const unitWidth = 200; 
        const divWidth = (n1 / d1) * unitWidth;
        const unitDivisorWidth = (n2 / d2) * unitWidth;

        // --- 縦線（グリッド）の描画 ---
        // 0から4までの整数区切りに、現在の分母の数だけ細かく線を入れる
        const maxRuler = 4;
        const subDivision = Math.max(d1, d2); // どちらかの分母に合わせてグリッドを細かくする
        
        for (let i = 0; i <= maxRuler * subDivision; i++) {
            const line = document.createElement('div');
            line.className = 'v-grid-line';
            line.style.left = (i * (unitWidth / subDivision)) + 'px';
            
            // 整数の場所は少し太くするか色を濃くするなどの調整も可能
            if (i % subDivision === 0) {
                line.style.backgroundColor = '#999';
            }
            
            visualArea.appendChild(line);
        }

        // 目盛り数字
        for (let i = 0; i <= maxRuler; i++) {
            const mark = document.createElement('div');
            mark.className = 'ruler-mark';
            mark.style.left = (i * unitWidth) + 'px';
            mark.innerHTML = `<div class="ruler-line"></div><div style="margin-top:5px;">${i}</div>`;
            visualArea.appendChild(mark);
        }

        // 上段：わられる数（赤）
        const div1 = document.createElement('div');
        div1.className = 'bar dividend-bar';
        div1.style.width = divWidth + 'px';
        div1.style.left = '0';
        div1.innerText = `${n1}/${d1}`;
        visualArea.appendChild(div1);

        // 下段：わる数（緑）
        let currentPos = 0;
        const totalHowMany = (n1 / d1) / (n2 / d2);
        let isFirst = true;
        while (currentPos < divWidth - 0.1 || isFirst) {
            const div2 = document.createElement('div');
            div2.className = 'bar divisor-bar';
            div2.style.width = unitDivisorWidth + 'px';
            div2.style.left = currentPos + 'px';
            
            if (currentPos + unitDivisorWidth > divWidth) {
                div2.style.opacity = "0.4";
                div2.style.borderStyle = "dashed"; 
            }
            if (unitDivisorWidth > 40) div2.innerText = `${n2}/${d2}`;
            
            visualArea.appendChild(div2);
            currentPos += unitDivisorWidth;
            isFirst = false;
            if (currentPos > 1000) break;
        }

        const displayCount = Math.round(totalHowMany * 100) / 100;
        document.getElementById('explanation').innerHTML = 
            `上の <span style="color:#e74c3c">赤色の長さ (${n1}/${d1})</span> の中に、<br>` +
            `下の <span style="color:#27ae60">緑色の長さ (${n2}/${d2})</span> は <strong>${displayCount}個分</strong> 入っています。`;
    }

    update();
</script>

</body>
</html>